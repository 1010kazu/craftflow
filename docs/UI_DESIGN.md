# UI/UX設計書

## 1. 画面構成

### 1.1 画面一覧

| 画面 | パス | 認証 | 説明 |
|------|------|------|------|
| ホーム | / | - | ログイン状態に応じてリダイレクト |
| ログイン | /login | 不要 | メール・パスワードでログイン |
| 登録 | /register | 不要 | 新規ユーザー登録 |
| ゲーム選択 | /games | 不要 | ゲームタイトル一覧 |
| アイテム一覧 | /games/:gameId/items | 不要 | アイテム一覧（検索・ソート） |
| アイテム詳細 | /games/:gameId/items/:itemId | 不要 | レシピ・レシピツリー表示 |
| ゲーム管理 | /admin/games | ADMIN | ゲームのCRUD |
| アイテム管理 | /admin/games/:gameId/items | ADMIN | アイテム・インポート |

### 1.2 画面遷移図

```
┌─────────────┐
│   ホーム    │
│     /       │
└──────┬──────┘
       │
       ▼
┌──────────────────────────────────────────┐
│  ログイン済み?                            │
│  ├─ Yes → /games                         │
│  └─ No  → /login                         │
└──────────────────────────────────────────┘

┌─────────────┐     ┌─────────────┐
│  ログイン   │────▶│   登録      │
│   /login    │◀────│  /register  │
└──────┬──────┘     └─────────────┘
       │
       ▼
┌─────────────┐
│ ゲーム選択  │
│   /games    │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│  アイテム一覧   │
│/games/:id/items │
└──────┬──────────┘
       │
       ▼
┌──────────────────────┐
│   アイテム詳細       │
│/games/:id/items/:id  │
│  └─ レシピツリー     │
└──────────────────────┘
```

---

## 2. 共通コンポーネント

### 2.1 ヘッダー（Header）

全ページに表示される共通ヘッダー（ログイン・登録画面を除く）

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                          [管理者] 👤          │
└─────────────────────────────────────────────────────────────┘
```

**要素:**
- ホームアイコン（/games へ遷移）
- CraftFlowロゴ
- 管理者バッジ（ADMIN権限時のみ表示）
- ユーザーアイコン（メニュー展開）

**ユーザーメニュー:**
```
┌─────────────────┐
│ user@example.com│ ← メールアドレス（非活性）
├─────────────────┤
│ 🔧 管理者ページ │ ← ADMIN権限時のみ
├─────────────────┤
│ 🚪 ログアウト   │
└─────────────────┘
```

**状態による表示:**
| 状態 | 表示 |
|------|------|
| 未ログイン | ログインボタンのみ |
| USER権限 | ユーザーメニュー |
| ADMIN権限 | 管理者バッジ + ユーザーメニュー |

---

## 3. 画面設計

### 3.1 ログイン画面

```
┌─────────────────────────────────────────┐
│              CraftFlow                  │
│                                         │
│         ┌─────────────────┐             │
│         │     ログイン     │             │
│         ├─────────────────┤             │
│         │                 │             │
│         │ メールアドレス  │             │
│         │ [____________]  │             │
│         │                 │             │
│         │ パスワード      │             │
│         │ [____________]  │             │
│         │                 │             │
│         │ [  ログイン  ]  │             │
│         │                 │             │
│         │ 新規登録はこちら │             │
│         └─────────────────┘             │
└─────────────────────────────────────────┘
```

### 3.2 ゲーム選択画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                                    👤          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ゲーム選択                                                 │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Factorio    │  │ Satisfactory │  │   Dyson...   │      │
│  │              │  │              │  │              │      │
│  │ 工場建設     │  │ 3D工場建設   │  │ スフィア構築 │      │
│  │ ゲーム       │  │ ゲーム       │  │ ゲーム       │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**カードの動作:**
- クリック → アイテム一覧画面へ遷移
- ホバー → 背景色変更

### 3.3 アイテム一覧画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                                    👤          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────┐  ┌────────────────────┐   │
│  │ 🔍 検索...                  │  │ 並び替え: 名前順 ▼ │   │
│  └─────────────────────────────┘  └────────────────────┘   │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ 鉄板         │  │ 銅板         │  │ 鋼鉄         │      │
│  │     [素材]   │  │     [素材]   │  │     [素材]   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ 製錬所       │  │ 組立機       │  │ 化学プラント │      │
│  │     [施設]   │  │     [施設]   │  │     [施設]   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                             │
│           [< 前へ]  1 / 5  [次へ >]                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**アイテムカード:**
- アイテム名
- アイテム種別バッジ
  - 施設: 緑色
  - 素材: オレンジ色
  - その他: グレー

**機能:**
- 検索: アイテム名の部分一致
- ソート: 名前順（昇順/降順）
- ページネーション: 20件/ページ

### 3.4 アイテム詳細画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                                    👤          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [← 戻る]                                                   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 鉄板                                        [素材]  │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │ レシピ情報                                          │   │
│  │ ─────────                                           │   │
│  │ 作成時間: 60秒                                      │   │
│  │ 作成個数: 1個                                       │   │
│  │ 必要施設: 製錬所                                    │   │
│  │                                                     │   │
│  │ 必要素材:                                           │   │
│  │ • 鉄鉱石 × 2                                        │   │
│  │                                                     │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │ レシピツリー          [すべて展開] [すべて折りたたむ]│   │
│  │ ─────────────                                       │   │
│  │ ▼ 鉄板 (必要数: 1)                                  │   │
│  │   ├─ 鉄鉱石 × 2 (基本素材)                          │   │
│  │   └─ 製錬所 (施設)                                  │   │
│  │                                                     │   │
│  │ ─────────────                                       │   │
│  │ 必要素材合計:                                       │   │
│  │ • 鉄鉱石: 2個                                       │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.5 レシピツリー詳細

```
レシピツリー
────────────

▼ 鉄板 (必要数: 1)                          [非表示]
│  └─ 作成時間: 60秒 / 必要施設: 製錬所
│
├─ 鉄鉱石 × 2                                 ← 基本素材（レシピなし）
│
└─ ▼ 製錬所 (必要数: 1)                      [非表示]
      └─ 作成時間: 120秒 / 必要施設: なし
      │
      ├─ 鉄板 × 5                             ← 循環参照の可能性
      └─ レンガ × 10
```

**ツリーノードの構造:**
```
┌────────────────────────────────────────────────────────┐
│ ▼/▶ アイテム名 × 数量 (必要数: X)        [非表示]    │
│     └─ 作成時間: Xs / 必要施設: Y                     │
└────────────────────────────────────────────────────────┘
```

**機能:**
- `▼/▶` クリック: 展開/折りたたみ
- `[非表示]` クリック: そのノード以下を非表示

---

## 4. 管理者画面

### 4.1 ゲーム管理画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                          [管理者] 👤          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ゲーム管理                              [+ 新規追加]       │
│                                                             │
│  ┌──────────────────────────────────────────────────┐      │
│  │ Factorio                                         │      │
│  │ 工場建設ゲーム                                   │      │
│  │                                                  │      │
│  │ [編集] [削除] [アイテム管理]                     │      │
│  └──────────────────────────────────────────────────┘      │
│                                                             │
│  ┌──────────────────────────────────────────────────┐      │
│  │ Satisfactory                                     │      │
│  │ 3D工場建設ゲーム                                 │      │
│  │                                                  │      │
│  │ [編集] [削除] [アイテム管理]                     │      │
│  └──────────────────────────────────────────────────┘      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 アイテム管理画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 CraftFlow                          [管理者] 👤          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  アイテム管理              [📤 インポート] [+ 新規追加]    │
│                                                             │
│  ┌──────────────────────────────────────────────────┐      │
│  │ 鉄板                                    [素材]   │      │
│  │                                                  │      │
│  │ [編集] [削除]                                    │      │
│  └──────────────────────────────────────────────────┘      │
│                                                             │
│  ┌──────────────────────────────────────────────────┐      │
│  │ 製錬所                                  [施設]   │      │
│  │                                                  │      │
│  │ [編集] [削除]                                    │      │
│  └──────────────────────────────────────────────────┘      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 インポートダイアログ

```
┌─────────────────────────────────────────┐
│  CSV/JSONインポート              [×]   │
├─────────────────────────────────────────┤
│                                         │
│  ファイルを選択:                        │
│  ┌─────────────────────────────────┐   │
│  │  [ファイルを選択]               │   │
│  │  example.csv                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  対応形式: CSV, JSON                    │
│                                         │
├─────────────────────────────────────────┤
│         [キャンセル] [インポート]       │
└─────────────────────────────────────────┘
```

---

## 5. レスポンシブデザイン

### 5.1 ブレークポイント

| サイズ | 幅 | レイアウト |
|--------|-----|-----------|
| xs | 0-599px | 1カラム |
| sm | 600-899px | 2カラム |
| md | 900-1199px | 3カラム |
| lg | 1200px+ | 3カラム |

### 5.2 モバイル対応

- アイテムカード: 1列表示
- レシピツリー: 横スクロール可能
- フォーム: 縦並びレイアウト
- ヘッダー: ハンバーガーメニュー（将来実装）

---

## 6. カラーパレット

```css
/* プライマリカラー（Material-UI デフォルト） */
--primary: #1976d2;
--primary-dark: #1565c0;
--primary-light: #42a5f5;

/* セカンダリカラー */
--secondary: #dc004e;

/* 背景色 */
--background: #fafafa;
--surface: #ffffff;

/* テキスト */
--text-primary: #212121;
--text-secondary: #757575;

/* アイテム種別 */
--facility: #4caf50;    /* 緑 - success */
--material: #ff9800;    /* オレンジ - warning */
--other: #9e9e9e;       /* グレー - default */
```

---

## 7. アクセシビリティ

### 7.1 キーボード操作

| キー | 動作 |
|------|------|
| Tab | フォーカス移動 |
| Enter | ボタン実行 |
| Space | 展開/折りたたみ |
| Escape | ダイアログを閉じる |

### 7.2 ARIA属性

- `aria-label`: ボタン・アイコンの説明
- `aria-expanded`: 展開状態
- `aria-haspopup`: メニューの存在
- `role`: 適切なロール設定

---

## 8. ローディング・エラー状態

### 8.1 ローディング

- CircularProgress（MUI）を中央に表示
- 各ページでマウント完了後にコンテンツ表示

### 8.2 エラー表示

- Alert コンポーネント（MUI）でエラーメッセージ表示
- フォームエラー: 入力フィールド下部に表示

---

## 9. パフォーマンス最適化

### 9.1 SSRハイドレーション対応

- `mounted` 状態でクライアントサイドレンダリングを制御
- Zustand の `_hasHydrated` フラグでストア同期を確認
- React Query の `enabled` オプションでクエリ実行タイミング制御

### 9.2 キャッシュ

- React Query: staleTime 60秒
- ページネーション: 各ページを個別にキャッシュ
